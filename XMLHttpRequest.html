<!DOCTYPE html>
<html lang="en">
<head>
  <title>XMLHttpRequest</title>

  <meta charset="utf-8">
  <meta name="Author" content="Aaron Rose" />
  
  <link rel="stylesheet" href="content/main.css" />

</head>
<body>
  <div>
	<div>
  <div>
        <h1>Aaron Rose</h1>
        <h2>CIT 261 - XMLHTTPRequest</h2>
        <a href="index.html">Home</a><br/><br/>
  </div>
  <div>
  <div><hr /></div>
	</div>
  <div>
	<a href="http://sportsworld.me" target="_blank">CompanyList</a>
	<a href="http://sportsworld.me" target="_blank">GetCompanyLogo</a>
        </div>
  <div id="ajaxData">
	<label>Click to Load Data: </label> <button onclick="loadData()">Load Data</button><br /><br />
	<label>Enter Company Id: </label> <input id="CompanyId" type="text" value=""></input><br />
	<button onclick="getImage(document.getElementById('CompanyId').value);">Get Company Logo</button><br /><br />
	<div id="ImgDiv"></div>
        </div>
	</div>
  </div>
</body>
  <script type="text/javascript">
	var companyListJson = "";
	var companyList = "";

	var loadData = function ()
	{
	var xhr = new XMLHttpRequest();
			
		xhr.open("GET", 'http://sportsworld.me', true);
		xhr.send(null);

		xhr.onreadystatechange = function () {
			if(xhr.readyState === 4 || xhr.readyState === XMLHttpRequest.DONE) {
	
			if(xhr.status === 200 || xhr.status == 0) {
				companyListJson = xhr.responseText;
				companyList = JSON.parse(companyListJson);
				useData();
		}
	else {
	}
     }
   }
 };

  function useData()
  {
	var checkElement = document.getElementById("rawDataOut");
		if( checkElement != null )
	{
		checkElement.remove();
		}
		var checkElement = document.getElementById("ImgDiv");
			if( checkElement != null )
			{
				checkElement.remove();
			}
		var divNode = document.createElement("DIV");
			divNode.id = "ImgDiv";
		var element = document.getElementById("ajaxData");
			element.appendChild(divNode);
			divNode = document.createElement("DIV");
			divNode.id = "rawDataOut";
		var node = document.createTextNode("JSONData = " + companyListJson);
			divNode.appendChild(node);
			element = document.getElementById("ajaxData");
			element.appendChild(divNode);
  }
  function getImage(id)
		{
		var imageItem = document.createElement("IMG");
			for(var ii=0; ii<companyList.length; ii++)
			{
				if(companyList[ii].Id == id )
				{
					imageItem.width = JSON.stringify( companyList[ii].Width );
					imageItem.height = JSON.stringify( companyList[ii].Height );
					imageItem.src = 'http://sportsworld.me' + companyList[ii].Id;
				var element = document.getElementById("ImgDiv");
					element.appendChild(imageItem);
					break;
				}
			}
		}
  </script>
</html>
